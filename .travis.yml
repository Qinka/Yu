# The config of Travis

#to use ubuntu 14.04
sudo: required
dist: trusty

# setting cache
cache:
  - $HOME/.stack
# the matrix of settings
matrix:
  include:
    - env: GHC_VER=8.2.2 THREADED=t RUN_TEST=t DEBUG=debug RUN_BUILD=true
      addons:
        apt:
          sources:
            - hvr-ghc
          packages:
            - wget
            - curl
            - ghc-8.2.2
            - mongodb
            - mongodb-clients
            - mongodb-server 
            - mongodb-dev

    - env: GHC_VER=8.2.2 THREADED=t RUN_TEST=t DEBUG=debug IS_DOCKER=docker LLVM=3.9 RUN_BUILD=true
      addons:
        apt:
          sources:
            - hvr-ghc
            - llvm-toolchain-trusty
            - llvm-toolchain-trusty-3.9
          packages:
            - ghc-8.2.2
            - curl
            - wget
            - mongodb
            - mongodb-clients
            - mongodb-server 
            - mongodb-dev
            - libllvm3.9
            - libllvm3.9-dbg
            - liblldb-3.9
            - lldb-3.9
            - llvm-3.9
            - llvm-3.9-dev
            - llvm-3.9-runtime


# using docker
services:
  - docker

# pre-install
before_install:
  - source $TRAVIS_BUILD_DIR/integration/ci.sh/init.sh


# build
script:
  - source $TRAVIS_BUILD_DIR/integration/ci.sh/build.sh
  - source $TRAVIS_BUILD_DIR/integration/ci.sh/test.sh

# update docker image
after_success:
  - source $TRAVIS_BUILD_DIR/integration/ci.sh/succ.sh
